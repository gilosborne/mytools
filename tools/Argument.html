<!DOCTYPE html>
<html lang="en" data-theme="cupcake">
<head>
  <meta charset="UTF-8" />
  <title>Debate Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.css" rel="stylesheet" />
</head>
<body class="flex flex-col min-h-screen">
  <main class="w-11/12 lg:w-2/3 mx-auto mt-6 space-y-6">
    <div class="card bg-white p-6 shadow">
      <h1 class="text-3xl font-bold mb-4">Debate Explorer</h1>
      <label class="label">Enter a topic:</label>
      <div class="flex gap-3">
        <input id="topic-input" type="text" placeholder="e.g. abortion" class="input input-bordered w-full" />
        <button class="btn btn-primary" onclick="fetchDebate()">Search</button>
      </div>
    </div>

    <div id="loading" class="w-full flex justify-center items-center hidden">
      <progress class="progress progress-primary w-56"></progress>
    </div>

    <div id="output" class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden">
      <div class="card bg-white p-4 shadow">
        <h2 class="text-xl font-bold text-green-700">Argument For</h2>
        <p><strong>Summary:</strong> <span id="for-summary" class="text-sm"></span></p>
        <p><strong>Why People Believe This:</strong> <span id="for-why" class="text-sm"></span></p>
        <p><strong>Resources:</strong></p>
        <ul id="for-resources" class="list-disc list-inside text-sm text-blue-600"></ul>
        <p><strong>Notable Supporters:</strong></p>
        <ul id="for-supporters" class="list-disc list-inside text-sm text-gray-800"></ul>
        <hr class="my-4" />
        <p><strong>Rebuttal to For:</strong> <span id="rebuttal-to-for" class="text-sm text-red-600"></span></p>
        <p><strong>Rebuttal to that Rebuttal:</strong> <span id="rebuttal-of-for-rebuttal" class="text-sm text-green-600"></span></p>
      </div>

      <div class="card bg-white p-4 shadow">
        <h2 class="text-xl font-bold text-red-700">Argument Against</h2>
        <p><strong>Summary:</strong> <span id="against-summary" class="text-sm"></span></p>
        <p><strong>Why People Believe This:</strong> <span id="against-why" class="text-sm"></span></p>
        <p><strong>Resources:</strong></p>
        <ul id="against-resources" class="list-disc list-inside text-sm text-blue-600"></ul>
        <p><strong>Notable Supporters:</strong></p>
        <ul id="against-supporters" class="list-disc list-inside text-sm text-gray-800"></ul>
        <hr class="my-4" />
        <p><strong>Rebuttal to Against:</strong> <span id="rebuttal-to-against" class="text-sm text-green-600"></span></p>
        <p><strong>Rebuttal to that Rebuttal:</strong> <span id="rebuttal-of-against-rebuttal" class="text-sm text-red-600"></span></p>
      </div>
    </div>

    <div id="aiwarn" class="w-full flex justify-center items-center">
      <p>Responses are generated by an AI and may not reflect the most current information or research on this topic.</p>
    </div>
  </main>

  <script>
    async function fetchDebate() {
      const topic = document.getElementById('topic-input').value.trim();
      if (!topic) return;

      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('output').classList.add('hidden');

      try {
        const response = await fetch("/api/debate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic })
        });

        const data = await response.json();

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('output').classList.remove('hidden');

        document.getElementById("for-summary").textContent = data.forArgument?.summary || "—";
        document.getElementById("for-why").textContent = data.forArgument?.whyPeopleBelieveThis || "—";
        const forResources = document.getElementById("for-resources");
        forResources.innerHTML = "";
        (data.forArgument?.resources || []).forEach(url => {
          const li = document.createElement("li");
          li.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
          forResources.appendChild(li);
        });
        const forSupporters = document.getElementById("for-supporters");
        forSupporters.innerHTML = "";
        (data.forArgument?.notableSupporters || []).forEach(name => {
          const li = document.createElement("li");
          li.textContent = name;
          forSupporters.appendChild(li);
        });
        document.getElementById("rebuttal-to-for").textContent = data.rebuttals?.toForArgument || "—";
        document.getElementById("rebuttal-of-for-rebuttal").textContent = data.rebuttals?.toRebuttalOfFor || "—";

        document.getElementById("against-summary").textContent = data.againstArgument?.summary || "—";
        document.getElementById("against-why").textContent = data.againstArgument?.whyPeopleBelieveThis || "—";
        const againstResources = document.getElementById("against-resources");
        againstResources.innerHTML = "";
        (data.againstArgument?.resources || []).forEach(url => {
          const li = document.createElement("li");
          li.innerHTML = `<a href="${url}" target="_blank">${url}</a>`;
          againstResources.appendChild(li);
        });
        const againstSupporters = document.getElementById("against-supporters");
        againstSupporters.innerHTML = "";
        (data.againstArgument?.notableSupporters || []).forEach(name => {
          const li = document.createElement("li");
          li.textContent = name;
          againstSupporters.appendChild(li);
        });
        document.getElementById("rebuttal-to-against").textContent = data.rebuttals?.toAgainstArgument || "—";
        document.getElementById("rebuttal-of-against-rebuttal").textContent = data.rebuttals?.toRebuttalOfAgainst || "—";

      } catch (err) {
        document.getElementById('loading').classList.add('hidden');
        console.error("Error fetching debate:", err);
        alert("Something went wrong. See console for details.");
      }
    }
  </script>
</body>
</html>
