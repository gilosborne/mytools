<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Facilitator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="../nav.js"></script>
</head>
<body class="bg-gray-100">

    <div id="nav-container"></div>

    <div class="container mx-auto p-6">
        <!-- Controls -->
        <div class="flex justify-end gap-2">
            <select id="saved-items" class="select select-bordered w-48" onchange="loadSavedItem()">
                <option value="">Select Saved Timer</option>
            </select>
            <button class="btn btn-secondary" onclick="addNewItem()">Create</button>
            <button id="save-btn" class="btn btn-success" onclick="saveItem()" disabled>Save</button>
            <button id="delete-btn" class="btn btn-error" onclick="deleteItem()" disabled>Delete</button>
        </div>

        <!-- Title -->
        <div class="mt-4">
            <h1 contenteditable="true" id="title" class="text-3xl font-bold" placeholder="Title">Meeting Timer</h1>
        </div>

        <!-- Description -->
        <div class="mt-2">
            <p id="description" contenteditable="true" class="border p-2 rounded bg-white" 
               placeholder="Description" onblur="formatDescription()">This is the page for the meeting timer</p>
        </div>

        <!-- Timer Setup -->
        <div id="timer-setup" class="mt-4">
            <label for="minutes" class="label">Set Timer (minutes):</label>
            <div class="flex gap-2">
                <input type="number" id="minutes" class="input input-bordered w-20" min="1" value="1">
                <button class="btn btn-primary" onclick="startTimer()">Start Timer</button>
            </div>
        </div>

        <!-- Running Timer -->
        <div id="timer-running" class="hidden mt-6">
            <h1 id="timer-display" class="text-4xl font-bold">00:00</h1>
            <button class="btn btn-error mt-4" onclick="cancelTimer()">Cancel</button>
        </div>

        <!-- Progress Bar -->
        <div class="mt-6 h-5 w-full bg-gray-300 rounded">
            <div id="progress-bar" class="h-5 bg-blue-500 rounded" style="width: 0%;"></div>
        </div>
    </div>

    <script>
    let countdown;
    let totalTime;
    let remainingTime;

    function startTimer() {
        const minutesInput = document.getElementById("minutes");
        totalTime = parseInt(minutesInput.value) * 60;
        if (totalTime <= 0) return;

        remainingTime = totalTime;
        document.getElementById("timer-setup").classList.add("hidden");
        document.getElementById("timer-running").classList.remove("hidden");
        updateTimerDisplay();

        countdown = setInterval(() => {
            if (remainingTime <= 0) {
                clearInterval(countdown);
                return;
            }
            remainingTime--;
            updateTimerDisplay();
            updateProgressBar();
        }, 1000);
    }

    function cancelTimer() {
        clearInterval(countdown);
        document.getElementById("timer-setup").classList.remove("hidden");
        document.getElementById("timer-running").classList.add("hidden");
        document.getElementById("progress-bar").style.width = "0%";
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(remainingTime / 60);
        const seconds = remainingTime % 60;
        document.getElementById("timer-display").textContent = 
            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function updateProgressBar() {
        const progress = ((totalTime - remainingTime) / totalTime) * 100;
        document.getElementById("progress-bar").style.width = `${progress}%`;
    }

    function saveItem() {
        const title = document.getElementById("title").textContent.trim();
        const description = document.getElementById("description").innerHTML.trim();
        const minutes = document.getElementById("minutes").value;

        if (!title || !description || !minutes) return;

        const savedItems = JSON.parse(localStorage.getItem("savedTimers")) || {};
        savedItems[title] = { title, description, minutes };
        localStorage.setItem("savedTimers", JSON.stringify(savedItems));

        populateDropdown();
    }

    function loadSavedItem() {
        const selectedTitle = document.getElementById("saved-items").value;
        if (!selectedTitle) return;

        const savedItems = JSON.parse(localStorage.getItem("savedTimers")) || {};
        const item = savedItems[selectedTitle];
        if (item) {
            document.getElementById("title").textContent = item.title;
            document.getElementById("description").innerHTML = item.description;
            document.getElementById("minutes").value = item.minutes;
            validateInputs();
        }
    }

    function addNewItem() {
        document.getElementById("title").textContent = "New Timer";
        document.getElementById("description").innerHTML = "Enter description here...";
        document.getElementById("minutes").value = "";
        validateInputs();
    }

    function validateInputs() {
        const title = document.getElementById("title").textContent.trim();
        const description = document.getElementById("description").textContent.trim();
        const minutes = document.getElementById("minutes").value;
        document.getElementById("save-btn").disabled = !(title && description && minutes);
        document.getElementById("delete-btn").disabled = !document.getElementById("saved-items").value;
    }

    function formatDescription() {
        const description = document.getElementById("description");
        description.innerHTML = description.innerHTML.replace(/\n/g, '<br>'); 
    }

    function deleteItem() {
        const selectedTitle = document.getElementById("saved-items").value;
        if (!selectedTitle) return;

        const savedItems = JSON.parse(localStorage.getItem("savedTimers")) || {};
        delete savedItems[selectedTitle];
        localStorage.setItem("savedTimers", JSON.stringify(savedItems));

        populateDropdown();
        addNewItem();
    }

    document.getElementById("title").addEventListener("input", validateInputs);
    document.getElementById("description").addEventListener("input", validateInputs);
    document.getElementById("minutes").addEventListener("input", validateInputs);
    document.getElementById("saved-items").addEventListener("change", validateInputs);

    function populateDropdown() {
        const savedItems = JSON.parse(localStorage.getItem("savedTimers")) || {};
        const dropdown = document.getElementById("saved-items");
        dropdown.innerHTML = "<option value=''>Select Saved Timer</option>";
        Object.keys(savedItems).forEach(title => {
            const option = document.createElement("option");
            option.value = title;
            option.textContent = title;
            dropdown.appendChild(option);
        });
    }

    populateDropdown();
    </script>

</body>
</html>
